{% extends "my_base.html" %}
{% import 'bootstrap/wtf.html' as wtf %}
{% block breadcrumb %}
    <a href="{{ url_for('admin.view_statistics') }}">
        <pb> Statystki</pb>
    </a>
{% endblock %}
{% block app_content %}
    <div class="row">
        <div class="col-md-4">
            {{ wtf.quick_form(form, button_map={'search_button': 'primary'}) }}
        </div>
    </div>
    <br>
    {% if statisticsList|length > 0 %}
        <table class="table">
            <th>Student</th>
            <th>Kurs</th>
            <th>Punkty</th>
            <th>Mo≈ºliwe punkty</th>
            <th>Procentowo</th>
            </thead>
            <tbody>
            {% for statistics in statisticsList %}
                {% set idx = loop.index %}
                <tr class='{{ idx }}' style="cursor: pointer"
                    onclick="showDetails($(this).attr('class'))">
                    <td><p>{{ statistics.user_email }}</p></td>
                    <td><p>{{ statistics.course_name }}</p></td>
                    <td><p>{{ statistics.user_points }}</p></td>
                    <td><p>{{ statistics.course_points }}</p></td>
                    <td><p>{{ statistics.get_percent_value() }}%</p></td>
                </tr>

                {% if statistics.solutions|length > 0 %}
                    {% for solution in statistics.solutions %}
                        <tr class='{{ idx }}details'
                            style="display:none; background-color: antiquewhite">
                            <td>{{ solution.author.email }}</td>
                            <td>{{ solution.get_course().name }}</td>
                            <td>{{ solution.exercise.lesson.name }}</td>
                            <td>{{ solution.exercise.name }}</td>
                            <td>{{ solution.points }} pkt</td>
                        </tr>
                    {% endfor %}
                {% endif %}
            {% endfor %}
            </tbody>
        </table>
        <button type="button"
                onclick="window.location.href='{{ url_for('admin.export_statistics', statistics_json = statistics_json) }}'"
                class="btn btn-warning">Export CSV
        </button>
        <script>
            function showDetails(param1) {
                var detailClass = param1 + 'details';
                var elems = document.getElementsByClassName(detailClass);
                if (elems[0].style.display === 'none') {
                    for (i = 0; i < elems.length; i++) {
                        elems[i].style.display = 'table-row';
                    }
                } else {
                    for (i = 0; i < elems.length; i++) {
                        elems[i].style.display = 'none';
                    }
                }
            }
        </script>

    {% endif %}

{% endblock %}
